#pragma once

#include <array>
#include <cstdint>

#include "Errors.hpp"

using Bitboard = uint64_t;

enum Turn { yellow, red };

struct LegalMoves {
    std::array<int, 7> legal_moves;
    int count;
};

class Board {
  public:
    Bitboard yellow_bitboard = 0b0;
    Bitboard red_bitboard = 0b0;

    auto play_move(unsigned int col, Turn turn) -> PlayMoveError;
    auto undo_move(unsigned int col, Turn turn) -> PlayMoveError;
    auto check_win(Turn turn) -> bool;
    void show_board() const;
    static void show_any_board(Bitboard board);
    auto get_legal_moves(Turn turn) -> LegalMoves;

    constexpr static const std::array<Bitboard, 7> column_masks = {
        0b0000000000000000000000'1000000'1000000'1000000'1000000'1000000'1000000,
        0b0000000000000000000000'0100000'0100000'0100000'0100000'0100000'0100000,
        0b0000000000000000000000'0010000'0010000'0010000'0010000'0010000'0010000,
        0b0000000000000000000000'0001000'0001000'0001000'0001000'0001000'0001000,
        0b0000000000000000000000'0000100'0000100'0000100'0000100'0000100'0000100,
        0b0000000000000000000000'0000010'0000010'0000010'0000010'0000010'0000010,
        0b0000000000000000000000'0000001'0000001'0000001'0000001'0000001'0000001,
    };

    constexpr static const std::array<Bitboard, 6> row_masks = {
        0b0000000000000000000000'0000000'0000000'0000000'0000000'0000000'1111111,
        0b0000000000000000000000'0000000'0000000'0000000'0000000'1111111'0000000,
        0b0000000000000000000000'0000000'0000000'0000000'1111111'0000000'0000000,
        0b0000000000000000000000'0000000'0000000'1111111'0000000'0000000'0000000,
        0b0000000000000000000000'0000000'1111111'0000000'0000000'0000000'0000000,
        0b0000000000000000000000'1111111'0000000'0000000'0000000'0000000'0000000,
    };
    constexpr static const std::array<Bitboard, 6> diagonal_mask = {
        0b0000000000000000000000'0000000'0000000'0000001'0000010'0000100'0001000,
        0b0000000000000000000000'0000000'0000001'0000010'0000100'0001000'0010000,
        0b0000000000000000000000'0000001'0000010'0000100'0001000'0010000'0100000,
        0b0000000000000000000000'0000010'0000100'0001000'0010000'0100000'1000000,
        0b0000000000000000000000'0000100'0001000'0010000'0100000'1000000'0000000,
        0b0000000000000000000000'0001000'0010000'0100000'1000000'0000000'0000000,
    };
    constexpr static const std::array<Bitboard, 6> other_diagonal_mask = {
        0b0000000000000000000000'0000000'0000000'1000000'0100000'0010000'0001000,
        0b0000000000000000000000'0000000'1000000'0100000'0010000'0001000'0000100,
        0b0000000000000000000000'1000000'0100000'0010000'0001000'0000100'0000010,
        0b0000000000000001000000'0100000'0010000'0001000'0000100'0000010'0000001,
        0b0000000100000000000000'0010000'0001000'0000100'0000010'0000001'0000000,
        0b0000010000000000000000'0001000'0000100'0000010'0000001'0000000'0000000,
    };
};
